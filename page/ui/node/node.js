"use strict";Editor.polymerElement({behaviors:[Editor.UI.PolymerFocusable,Editor.UI.Droppable],hostAttributes:{droppable:"node","single-drop":!0},listeners:{focus:"_onFocus",blur:"_onBlur",click:"_onClick","drop-area-enter":"_onDropAreaEnter","drop-area-leave":"_onDropAreaLeave","drop-area-accept":"_onDropAreaAccept"},properties:{value:{type:String,value:null,notify:!0,observer:"_valueChanged"},typeid:{type:String,value:"Unknown"},typename:{type:String,value:"Unknown"},highlighted:{type:Boolean,value:!1,reflectToAttribute:!0},invalid:{type:Boolean,value:!1,reflectToAttribute:!0}},ready:function(){this._initFocusable(this),this._initDroppable(this.$.dropArea),this._nodeName="None",this._missed=!1},_onDragOver:function(e){var t=Editor.UI.DragDrop.type(e.dataTransfer);return"node"!==t?void Editor.UI.DragDrop.allowDrop(e.dataTransfer,!1):(e.preventDefault(),e.stopPropagation(),void(this.highlighted?this.invalid?(Editor.UI.DragDrop.updateDropEffect(e.dataTransfer,"none"),Editor.UI.DragDrop.allowDrop(e.dataTransfer,!1)):(Editor.UI.DragDrop.updateDropEffect(e.dataTransfer,"copy"),Editor.UI.DragDrop.allowDrop(e.dataTransfer,!0)):(Editor.UI.DragDrop.updateDropEffect(e.dataTransfer,"none"),Editor.UI.DragDrop.allowDrop(e.dataTransfer,!1))))},_onClick:function(e){e.stopPropagation(),Editor.Ipc.sendToAll("hierarchy:hint",this._nodeID)},_onDropAreaEnter:function(e){var t=this;e.stopPropagation();var i=e.detail.dragItems;this._requestID&&(Editor.Ipc.cancelRequest(this._requestID),this._requestID=null),this.invalid=!0,this._requestID=Editor.Ipc.sendToPanel("scene","scene:query-node-info",i[0],this.typeid,function(e,i){t._requestID=null,t.highlighted=!0,"cc.Node"!==t.typeid?t.invalid=!i.compID:t.invalid=!1,t._cacheNodeID=i.nodeID,t._cacheCompID=i.compID})},_onDropAreaLeave:function(e){e.stopPropagation(),this._requestID&&(Editor.Ipc.cancelRequest(this._requestID),this._requestID=null),this.highlighted=!1,this.invalid=!1},_onDropAreaAccept:function(e){var t=this;e.stopPropagation(),this._requestID&&(Editor.Ipc.cancelRequest(this._requestID),this._requestID=null),this.highlighted=!1,this.invalid=!1;var i=e.detail.dragItems,o=i[0];"cc.Node"!==this.typeid&&(o=this._cacheCompID),this._compID=this._cacheCompID,this._nodeID=this._cacheNodeID,this.set("value",o),o||(this._nodeName="None",this._missed=!1),this.async(function(){t.fire("end-editing")},1)},_nodeClass:function(e,t){return t?"missed name":e?"name":"null name"},_labelLeftClass:function(e){return this._shouldHide(e)?"label":"label left"},_labelRightClass:function(e){return this._shouldHide(e)?"label":"label right"},_shouldHide:function(e){return!e},_valueChanged:function(){var e=this;return this.value?(this._requestID&&(Editor.Ipc.cancelRequest(this._requestID),this._requestID=null),void(this._requestID=Editor.Ipc.sendToPanel("scene","scene:query-node-info",this.value,this.typeid,function(t,i){e._requestID=null,e._nodeName=i.name,e._missed=i.missed,e._nodeID=i.nodeID,e._compID=i.compID,i.missed&&(e._nodeName="Missing Reference")},500))):(this._nodeName="None",void(this._missed=!1))},_onBrowseClick:function(e){e.stopPropagation(),this.fire("filter-node",this),Editor.Ipc.sendToPanel("hierarchy","hierarchy:filter","t:"+this.typeid)},_onClearClick:function(e){var t=this;e.stopPropagation(),this.set("value",""),this.async(function(){t.fire("end-editing")},1)}});